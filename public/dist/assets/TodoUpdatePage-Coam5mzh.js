import{af as d,z as M,a3 as W,r as u,a8 as T,S as H,j as e,B as l,U as A,V as x,W as h,X as j,Y as S,Z as f,I as Q,ah as g,T as L,ai as O}from"./index-DIcS40jd.js";import{B as X}from"./breadcrumbs-BalubsiJ.js";import{P as Z}from"./page-container-BHOmdAjH.js";import{H as G}from"./heading-8Q5dhaw2.js";import{A as J}from"./alert-modal-k4EI7F0W.js";import{S as F,a as D,b as P,c as I,d as b}from"./select-PErHbfmX.js";import{b as K,u as p}from"./todoAPI-Cy9K8Y_H.js";import{b as ee}from"./buildingDrawings-yKSIcWS5.js";import{b as se,f as te}from"./projectAPI-kcs8BLOO.js";import{C as ie}from"./chevron-left-ZwcPHqCb.js";import"./index-D3WTB7gC.js";import"./scroll-area-CZdIeNSX.js";import"./dialog-sOsU102b.js";import"./index-CM_goT24.js";import"./Combination-CcrjQx5z.js";const w=localStorage.getItem("role"),re=d.object({Senior:d.string().optional(),Description:d.string().optional(),Status:d.string({required_error:"Status is required"}),SeniorQuery:d.string().optional(),AdminQuery:d.string().optional()}),ae=()=>{const y=M(),o=W(),[k,$]=u.useState([]),[s,B]=u.useState({}),[V]=u.useState(!1),[U,m]=u.useState(!1),{id:c}=T(),a=H({resolver:L(re),defaultValues:{Senior:"",Status:"",Description:"",SeniorQuery:"",AdminQuery:""}});u.useEffect(()=>{(async()=>{const i=await O();$(i);const r=await K(c);B(r),r&&a.reset({Status:r.Status,Description:r.Description,Senior:r.Senior||"",AdminQuery:r.AdminQuery||"",SeniorQuery:r.SeniorQuery||""})})()},[c,a]);const E=async()=>{const r="Final Reviewing",n=`${s.Senior} sent to Yash Sir for final review.`,v=[...s.Activity,n];await p(c,{Status:r,Activity:v,SeniorReview:!1,FinalReview:!0}),m(!1),o("/todos")},Y=async()=>{const i="Completed",n=[...s.Activity,"Yash Sir Reviewed and marked it complete."];await p(c,{Status:i,Mailed:"Pending",Activity:n,FinalReview:!1}),m(!1);const R=await se(s==null?void 0:s.Project_Id);R.Activity=[...R.Activity,s==null?void 0:s.Title];const N=await te(s==null?void 0:s.Project_Id,R);await ee(N==null?void 0:N.updatedProject),o("/todos")},_=async t=>{if(t.Senior){t.Status=`${t.Senior} Reviewing`;const r=`${s.Inhouse_Engineer} sent to ${t.Senior} for Review.`,n=[...s.Activity,r];t={...t,Activity:n,SeniorReview:!0}}await p(c,t),o("/todos")},q=async t=>{console.log(t),s.Senior="";const i=!1,r=!1;t.Status=`Query Raised by Senior ${t.Senior}`;const n=t.Status+", Query:"+t.SeniorQuery,v=[...s.Activity,n];t={...t,Senior:"",Activity:v,FinalReview:i,SeniorReview:r},await p(c,t),o("/todos")},z=async t=>{console.log(t);const i=!1;t.Status="Query Raised by Yash Sir";const r=t.Status+", Query:"+t.AdminQuery,n=[...s.Activity,r];t={...t,Activity:n,FinalReview:i},await p(c,t),o("/todos")};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsx(J,{isOpen:U,onClose:()=>m(!1),onConfirm:w==="senior"?E:Y,loading:V}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx(G,{title:"Update Todo",description:"Edit todo details"}),e.jsxs(l,{onClick:()=>y.back(),children:[e.jsx(ie,{className:"h-4 w-4"}),"Back"]})]}),w==="engineer"&&(s==null?void 0:s.Status)!=="Completed"&&e.jsx(A,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(_),className:"mt-12 space-y-12",autoComplete:"off",children:e.jsx("div",{className:"grid gap-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid gap-x-4 gap-y-4 md:grid-cols-3",children:[!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:a.control,name:"Status",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Status"}),e.jsx(S,{children:e.jsxs(F,{onValueChange:t.onChange,defaultValue:t.value,...t,children:[e.jsx(D,{children:e.jsx(P,{placeholder:s.Status})}),e.jsxs(I,{children:[e.jsx(b,{value:"Not Started",children:"Not Started"}),e.jsx(b,{value:"In Progress",children:"In Progress"}),e.jsx(b,{value:"Revised Drawing Submited",children:"Revised Drawing Submited"})]})]})}),e.jsx(f,{})]})}),e.jsx(x,{control:a.control,name:"Description",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Description"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"description",...t})}),e.jsx(f,{})]})}),(s==null?void 0:s.SeniorReview)&&e.jsx(g,{className:"text-red-500",children:"Waiting for review from senior *"}),(s==null?void 0:s.FinalReview)&&e.jsx(g,{className:"text-red-500",children:"Waiting for final review from Yash Sale sir *"}),!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:a.control,name:"Senior",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Send for review to senior"}),e.jsx(S,{children:e.jsxs(F,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(D,{children:e.jsx(P,{placeholder:"Select Senior"})}),e.jsx(I,{children:k.map(i=>e.jsx(b,{value:i==null?void 0:i.username,children:i==null?void 0:i.full_name},i==null?void 0:i.id))})]})}),e.jsx(f,{})]})})]}),e.jsxs("div",{className:"m-8 flex items-center justify-center gap-4",children:[e.jsx(l,{type:"button",variant:"secondary",className:"rounded-full",size:"lg",onClick:()=>o("/todos"),children:"Cancel"}),e.jsx(l,{type:"submit",variant:"default",className:"rounded-full",size:"lg",children:"Update"})]})]})})})}),w==="senior"&&(s==null?void 0:s.SeniorReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(q),className:"space-y-4",children:[e.jsx(x,{control:a.control,name:"SeniorQuery",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(f,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:bg-red-100 hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(g,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:bg-green-100 hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]}),w==="root"&&(s==null?void 0:s.FinalReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(z),className:"space-y-4",children:[e.jsx(x,{control:a.control,name:"AdminQuery",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(f,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(g,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]})]})},ne=ae;function be(){const{id:y}=T(),o=[{title:"Dashboard",link:"/"},{title:"Todos",link:"/todo"},{title:`${y}`,link:`/todo/${y}`}];return e.jsx(Z,{scrollable:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{items:o}),e.jsx(ne,{})]})})}export{be as default};
