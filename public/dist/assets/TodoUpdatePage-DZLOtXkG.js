import{Q as d,t as Y,J as H,r as u,N as k,v as L,j as e,B as l,F as A,x,y as j,z as h,A as S,D as p,I as Q,S as w,w as O}from"./index-BHqYEVpr.js";import{B as W}from"./breadcrumbs-CxWpwQan.js";import{P as J}from"./page-container-HnvLVdCl.js";import{H as G}from"./heading-DLKN7QJX.js";import{A as K}from"./alert-modal-BbSlZVHF.js";import{S as C,a as D,b as P,c as I,d as R}from"./select-DFVNYac5.js";import{b as X,u as y}from"./todoAPI-DtW74Z3t.js";import{b as Z}from"./api-fvz03lhi.js";import{b as ee}from"./buildingDrawings-CixffuwQ.js";import{b as se,u as te}from"./projectAPI-Ct98bTuH.js";import{C as ie}from"./chevron-left-DTSZ-l0x.js";import"./index-BiMNKS6m.js";import"./scroll-area-Kh0p6MKS.js";import"./index-KnQW5NRs.js";import"./Combination-C5Dgzbfj.js";import"./axios-Cm0UX6qg.js";const N=localStorage.getItem("role"),re=d.object({Senior:d.string().optional(),Description:d.string().optional(),Status:d.string({required_error:"Status is required"}),SeniorQuery:d.string().optional(),AdminQuery:d.string().optional()}),oe=()=>{const f=Y(),a=H(),[T,$]=u.useState([]),[s,B]=u.useState({}),[V]=u.useState(!1),[E,m]=u.useState(!1),{id:c}=k(),o=L({resolver:O(re),defaultValues:{Senior:"",Status:"",Description:"",SeniorQuery:"",AdminQuery:""}});u.useEffect(()=>{(async()=>{const i=await Z();$(i);const r=await X(c);B(r),console.log(r),r&&o.reset({Status:r.Status,Description:r.Description,Senior:r.Senior||"",AdminQuery:r.AdminQuery||"",SeniorQuery:r.SeniorQuery||""})})()},[c,o]);const U=async()=>{const r="Final Reviewing",n=`${s.Senior} sent to Yash Sir for final review.`,v=[...s.Activity,n];await y(c,{Status:r,Activity:v,SeniorReview:!1,FinalReview:!0}),m(!1),a("/todos")},_=async()=>{const i="Completed",n=[...s.Activity,"Yash Sir Reviewed and marked it complete."];await y(c,{Status:i,Mailed:"Pending",Activity:n,FinalReview:!1}),m(!1);const g=await se(s==null?void 0:s.Project_Id);console.log(g),g.Activity=[...g.Activity,s==null?void 0:s.Title];const b=await te(s==null?void 0:s.Project_Id,g);console.log(b),await ee(b==null?void 0:b.updatedProject),a("/todos")},q=async t=>{if(t.Senior){t.Status=`${t.Senior} Reviewing`;const r=`${s.Inhouse_Engineer} sent to ${t.Senior} for Review.`,n=[...s.Activity,r];console.log(n),t={...t,Activity:n,SeniorReview:!0}}await y(c,t),a("/todos")},z=async t=>{console.log(t),s.Senior="";const i=!1,r=!1;t.Status=`Query Raised by Senior ${t.Senior}`;const n=t.Status+", Query:"+t.SeniorQuery,v=[...s.Activity,n];t={...t,Senior:"",Activity:v,FinalReview:i,SeniorReview:r},await y(c,t),a("/todos")},M=async t=>{console.log(t);const i=!1;t.Status="Query Raised by Yash Sir";const r=t.Status+", Query:"+t.AdminQuery,n=[...s.Activity,r];t={...t,Activity:n,FinalReview:i},await y(c,t),a("/todos")};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsx(K,{isOpen:E,onClose:()=>m(!1),onConfirm:N==="senior"?U:_,loading:V}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx(G,{title:"Update Todo",description:"Edit todo details"}),e.jsxs(l,{onClick:()=>f.back(),children:[e.jsx(ie,{className:"h-4 w-4"}),"Back"]})]}),N==="engineer"&&(s==null?void 0:s.Status)!=="Completed"&&e.jsx(A,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(q),className:"mt-12 space-y-12",autoComplete:"off",children:e.jsx("div",{className:"grid gap-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid gap-x-4 gap-y-4 md:grid-cols-3",children:[!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:o.control,name:"Status",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Status"}),e.jsx(S,{children:e.jsxs(C,{onValueChange:t.onChange,defaultValue:t.value,...t,children:[e.jsx(D,{children:e.jsx(P,{placeholder:s.Status})}),e.jsxs(I,{children:[e.jsx(R,{value:"Not Started",children:"Not Started"}),e.jsx(R,{value:"In Progress",children:"In Progress"}),e.jsx(R,{value:"Revised Drawing Submited",children:"Revised Drawing Submited"})]})]})}),e.jsx(p,{})]})}),e.jsx(x,{control:o.control,name:"Description",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Description"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"description",...t})}),e.jsx(p,{})]})}),(s==null?void 0:s.SeniorReview)&&e.jsx(w,{className:"text-red-500",children:"Waiting for review from senior *"}),(s==null?void 0:s.FinalReview)&&e.jsx(w,{className:"text-red-500",children:"Waiting for final review from Yash Sale sir *"}),!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:o.control,name:"Senior",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Send for review to senior"}),e.jsx(S,{children:e.jsxs(C,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(D,{children:e.jsx(P,{placeholder:"Select Senior"})}),e.jsx(I,{children:T.map(i=>e.jsx(R,{value:i==null?void 0:i.username,children:i==null?void 0:i.full_name},i==null?void 0:i.id))})]})}),e.jsx(p,{})]})})]}),e.jsxs("div",{className:"m-8 flex items-center justify-center gap-4",children:[e.jsx(l,{type:"button",variant:"secondary",className:"rounded-full",size:"lg",onClick:()=>a("/todos"),children:"Cancel"}),e.jsx(l,{type:"submit",variant:"default",className:"rounded-full",size:"lg",children:"Update"})]})]})})})}),N==="senior"&&(s==null?void 0:s.SeniorReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(z),className:"space-y-4",children:[e.jsx(x,{control:o.control,name:"SeniorQuery",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(p,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(w,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]}),N==="root"&&(s==null?void 0:s.FinalReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(M),className:"space-y-4",children:[e.jsx(x,{control:o.control,name:"AdminQuery",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(Q,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(p,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(w,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]})]})},ne=oe;function we(){const{id:f}=k(),a=[{title:"Dashboard",link:"/"},{title:"Todos",link:"/todo"},{title:`${f}`,link:`/todo/${f}`}];return e.jsx(J,{scrollable:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{items:a}),e.jsx(ne,{})]})})}export{we as default};
