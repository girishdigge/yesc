import{U as d,t as Y,J as H,r as u,P as k,v as L,j as e,B as l,F as A,x,y as j,z as h,A as S,D as f,I as F,V as g,w as O}from"./index-BirjyYCK.js";import{B as W}from"./breadcrumbs-Db9tqQQQ.js";import{P as J}from"./page-container-Ch1MlBkd.js";import{H as G}from"./heading-BrIWLUOq.js";import{A as K}from"./alert-modal-cwZN9oy5.js";import{S as C,a as D,b as P,c as I,d as b}from"./select-Cu7ZoTPv.js";import{b as X,u as y}from"./todoAPI-C5CE0O1H.js";import{f as Z}from"./api-BsWGTiFV.js";import{b as ee}from"./buildingDrawings-BWCj3A_t.js";import{b as se,f as te}from"./projectAPI-Ckeg2yN0.js";import{C as ie}from"./chevron-left-NGMl8fvv.js";import"./index-j3Cmd6QT.js";import"./scroll-area-BMuCLgJC.js";import"./index-Cb5npXBK.js";import"./Combination-DFHS0Xp4.js";const w=localStorage.getItem("role"),re=d.object({Senior:d.string().optional(),Description:d.string().optional(),Status:d.string({required_error:"Status is required"}),SeniorQuery:d.string().optional(),AdminQuery:d.string().optional()}),ne=()=>{const p=Y(),o=H(),[T,$]=u.useState([]),[s,B]=u.useState({}),[V]=u.useState(!1),[U,m]=u.useState(!1),{id:c}=k(),n=L({resolver:O(re),defaultValues:{Senior:"",Status:"",Description:"",SeniorQuery:"",AdminQuery:""}});u.useEffect(()=>{(async()=>{const i=await Z();$(i);const r=await X(c);B(r),r&&n.reset({Status:r.Status,Description:r.Description,Senior:r.Senior||"",AdminQuery:r.AdminQuery||"",SeniorQuery:r.SeniorQuery||""})})()},[c,n]);const E=async()=>{const r="Final Reviewing",a=`${s.Senior} sent to Yash Sir for final review.`,v=[...s.Activity,a];await y(c,{Status:r,Activity:v,SeniorReview:!1,FinalReview:!0}),m(!1),o("/todos")},_=async()=>{const i="Completed",a=[...s.Activity,"Yash Sir Reviewed and marked it complete."];await y(c,{Status:i,Mailed:"Pending",Activity:a,FinalReview:!1}),m(!1);const R=await se(s==null?void 0:s.Project_Id);R.Activity=[...R.Activity,s==null?void 0:s.Title];const N=await te(s==null?void 0:s.Project_Id,R);await ee(N==null?void 0:N.updatedProject),o("/todos")},q=async t=>{if(t.Senior){t.Status=`${t.Senior} Reviewing`;const r=`${s.Inhouse_Engineer} sent to ${t.Senior} for Review.`,a=[...s.Activity,r];t={...t,Activity:a,SeniorReview:!0}}await y(c,t),o("/todos")},z=async t=>{console.log(t),s.Senior="";const i=!1,r=!1;t.Status=`Query Raised by Senior ${t.Senior}`;const a=t.Status+", Query:"+t.SeniorQuery,v=[...s.Activity,a];t={...t,Senior:"",Activity:v,FinalReview:i,SeniorReview:r},await y(c,t),o("/todos")},M=async t=>{console.log(t);const i=!1;t.Status="Query Raised by Yash Sir";const r=t.Status+", Query:"+t.AdminQuery,a=[...s.Activity,r];t={...t,Activity:a,FinalReview:i},await y(c,t),o("/todos")};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsx(K,{isOpen:U,onClose:()=>m(!1),onConfirm:w==="senior"?E:_,loading:V}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx(G,{title:"Update Todo",description:"Edit todo details"}),e.jsxs(l,{onClick:()=>p.back(),children:[e.jsx(ie,{className:"h-4 w-4"}),"Back"]})]}),w==="engineer"&&(s==null?void 0:s.Status)!=="Completed"&&e.jsx(A,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(q),className:"mt-12 space-y-12",autoComplete:"off",children:e.jsx("div",{className:"grid gap-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"grid gap-x-4 gap-y-4 md:grid-cols-3",children:[!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:n.control,name:"Status",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Status"}),e.jsx(S,{children:e.jsxs(C,{onValueChange:t.onChange,defaultValue:t.value,...t,children:[e.jsx(D,{children:e.jsx(P,{placeholder:s.Status})}),e.jsxs(I,{children:[e.jsx(b,{value:"Not Started",children:"Not Started"}),e.jsx(b,{value:"In Progress",children:"In Progress"}),e.jsx(b,{value:"Revised Drawing Submited",children:"Revised Drawing Submited"})]})]})}),e.jsx(f,{})]})}),e.jsx(x,{control:n.control,name:"Description",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Description"}),e.jsx(S,{children:e.jsx(F,{placeholder:"description",...t})}),e.jsx(f,{})]})}),(s==null?void 0:s.SeniorReview)&&e.jsx(g,{className:"text-red-500",children:"Waiting for review from senior *"}),(s==null?void 0:s.FinalReview)&&e.jsx(g,{className:"text-red-500",children:"Waiting for final review from Yash Sale sir *"}),!(s!=null&&s.SeniorReview)&&!(s!=null&&s.FinalReview)&&e.jsx(x,{control:n.control,name:"Senior",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Send for review to senior"}),e.jsx(S,{children:e.jsxs(C,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(D,{children:e.jsx(P,{placeholder:"Select Senior"})}),e.jsx(I,{children:T.map(i=>e.jsx(b,{value:i==null?void 0:i.username,children:i==null?void 0:i.full_name},i==null?void 0:i.id))})]})}),e.jsx(f,{})]})})]}),e.jsxs("div",{className:"m-8 flex items-center justify-center gap-4",children:[e.jsx(l,{type:"button",variant:"secondary",className:"rounded-full",size:"lg",onClick:()=>o("/todos"),children:"Cancel"}),e.jsx(l,{type:"submit",variant:"default",className:"rounded-full",size:"lg",children:"Update"})]})]})})})}),w==="senior"&&(s==null?void 0:s.SeniorReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(z),className:"space-y-4",children:[e.jsx(x,{control:n.control,name:"SeniorQuery",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(F,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(f,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:bg-red-100 hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(g,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:bg-green-100 hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]}),w==="root"&&(s==null?void 0:s.FinalReview)&&e.jsxs("div",{className:"m-4 grid gap-12 md:m-12 md:grid-cols-2 ",children:[e.jsx(A,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-4",children:[e.jsx(x,{control:n.control,name:"AdminQuery",render:({field:t})=>e.jsxs(j,{children:[e.jsx(h,{children:"Raise Query"}),e.jsx(S,{children:e.jsx(F,{placeholder:"Provide Feedback or Raise a Query",...t})}),e.jsx(f,{})]})}),e.jsx(l,{className:"w-full bg-custom-red text-base font-medium hover:text-custom-red",type:"submit",children:"Raise Query"})]})}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(g,{className:"text-base font-medium",children:"Reviewed, No query, submit to client"}),e.jsx(l,{className:"bg-custom-green text-base font-medium hover:text-custom-green",type:"button",onClick:()=>m(!0),children:"Confirm & Submit"})]})]})]})},ae=ne;function be(){const{id:p}=k(),o=[{title:"Dashboard",link:"/"},{title:"Todos",link:"/todo"},{title:`${p}`,link:`/todo/${p}`}];return e.jsx(J,{scrollable:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{items:o}),e.jsx(ae,{})]})})}export{be as default};
